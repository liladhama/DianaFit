# Диагностика и исправление ошибки 500 в чате с Дианой

В этом документе описаны шаги для диагностики и исправления ошибки 500 (Internal Server Error) при отправке сообщений в чат с Дианой.

## Обнаруженные проблемы

1. **Несоответствие между фронтендом и бэкендом**: 
   - Фронтенд отправляет `conversation`, но бэкенд ожидает `context`.
   - Исправлено добавлением поддержки обоих полей.

2. **Проблемы с API ключом Mistral**:
   - Ключ в файле `.env` выглядит некорректным (слишком короткий).
   - Ключи Mistral обычно начинаются с `mis_` и имеют длину около 30-40 символов.

3. **Недостаточное логирование ошибок**:
   - Ошибки API не логировались с достаточной детализацией.
   - Добавлено подробное логирование для упрощения диагностики.

## Как исправить

1. **Обновите API ключ Mistral**:
   - Получите новый ключ на [console.mistral.ai](https://console.mistral.ai/)
   - Замените значение `MISTRAL_API_KEY` в файле `backend/.env`

2. **Проверьте работу API**:
   - Запустите скрипт `check-mistral-api.js` командой: `node check-mistral-api.js`
   - Он проверит статус API и ваш ключ

3. **Проверьте чат с Дианой**:
   - Запустите скрипт `check-diana-chat.bat` для полной диагностики
   - Или запустите backend и затем выполните `node test-diana-chat.js`

## Дополнительные изменения

1. **Добавлен резервный режим**:
   - Если API недоступен, чат будет использовать предопределенные ответы
   - Это обеспечит работу приложения даже при проблемах с API

2. **Улучшена обработка ошибок**:
   - Добавлены дополнительные проверки и информативные сообщения
   - Улучшено логирование для упрощения отладки

## Что делать при дальнейших проблемах

1. Проверьте консоль сервера на предмет ошибок
2. Убедитесь, что ключ API активен и правильно настроен
3. Проверьте квоты и лимиты вашего аккаунта Mistral AI
4. Если проблема не решена, возможно стоит рассмотреть альтернативные API или модели
