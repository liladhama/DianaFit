<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è DianaFit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        .status-box {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .status {
            font-size: 18px;
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status.success {
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid rgba(40, 167, 69, 0.5);
        }
        .status.error {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid rgba(220, 53, 69, 0.5);
        }
        .status.loading {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid rgba(255, 193, 7, 0.5);
        }
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .response-box {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è DianaFit</h1>
        <p>Frontend: <strong>localhost:3000</strong> ‚Üí Backend: <strong>localhost:3001</strong></p>
        
        <div class="status-box">
            <h2>üì° –°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</h2>
            
            <div class="status loading" id="backend-status">
                <span>Backend (localhost:3001)</span>
                <span>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            
            <div class="status loading" id="cors-status">
                <span>CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                <span>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            
            <div class="status loading" id="ai-status">
                <span>–ò–ò –∞–≥–µ–Ω—Ç –î–∏–∞–Ω–∞</span>
                <span>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
        </div>

        <div class="status-box">
            <h2>üß™ –¢–µ—Å—Ç—ã API</h2>
            
            <button class="test-button" onclick="testBackendHealth()">
                üè• –¢–µ—Å—Ç –∑–¥–æ—Ä–æ–≤—å—è backend
            </button>
            
            <button class="test-button" onclick="testQuizConfig()">
                üìã –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥–∞ –∫–≤–∏–∑–∞
            </button>
            
            <button class="test-button" onclick="testAIChat()">
                ü§ñ –¢–µ—Å—Ç —á–∞—Ç–∞ —Å –ò–ò
            </button>
            
            <button class="test-button" onclick="testFullStack()">
                üöÄ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
            </button>
            
            <div id="test-results"></div>
        </div>

        <div class="status-box">
            <h2>üéØ –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h2>
            <button class="test-button" onclick="window.open('http://localhost:3001', '_blank')">
                üîó –û—Ç–∫—Ä—ã—Ç—å Backend
            </button>
            <button class="test-button" onclick="window.open('http://localhost:3000', '_blank')">
                üîó –û—Ç–∫—Ä—ã—Ç—å Frontend
            </button>
            <button class="test-button" onclick="window.location.href='/public/test-videos.html'">
                üé• –¢–µ—Å—Ç –≤–∏–¥–µ–æ
            </button>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:3001';
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            checkConnection();
        });

        async function checkConnection() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
            try {
                const response = await fetch(`${BACKEND_URL}/`, { 
                    method: 'GET',
                    mode: 'cors'
                });
                if (response.ok) {
                    setStatus('backend-status', 'success', '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω');
                    checkCORS();
                } else {
                    setStatus('backend-status', 'error', '‚ùå –û—à–∏–±–∫–∞ HTTP');
                }
            } catch (error) {
                setStatus('backend-status', 'error', '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                setStatus('cors-status', 'error', '‚ùå –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                setStatus('ai-status', 'error', '‚ùå –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        async function checkCORS() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/quiz-config`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    setStatus('cors-status', 'success', '‚úÖ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç');
                    checkAI();
                } else {
                    setStatus('cors-status', 'error', '‚ùå CORS –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                setStatus('cors-status', 'error', '‚ùå CORS –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            }
        }

        async function checkAI() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/chat-diana`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç.',
                        context: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'
                    })
                });
                if (response.ok) {
                    setStatus('ai-status', 'success', '‚úÖ –ò–ò –≥–æ—Ç–æ–≤');
                } else {
                    setStatus('ai-status', 'error', '‚ùå –ò–ò –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                setStatus('ai-status', 'error', '‚ùå –ò–ò –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }

        function setStatus(elementId, statusClass, text) {
            const element = document.getElementById(elementId);
            element.className = `status ${statusClass}`;
            element.children[1].textContent = text;
        }

        async function testBackendHealth() {
            showTestResult('üè• –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backend –∑–¥–æ—Ä–æ–≤—å—è...');
            try {
                const response = await fetch(`${BACKEND_URL}/`);
                const text = await response.text();
                showTestResult(`‚úÖ Backend –æ—Ç–≤–µ—Ç–∏–ª: "${text}"`);
            } catch (error) {
                showTestResult(`‚ùå –û—à–∏–±–∫–∞ backend: ${error.message}`);
            }
        }

        async function testQuizConfig() {
            showTestResult('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –∫–≤–∏–∑–∞...');
            try {
                const response = await fetch(`${BACKEND_URL}/api/quiz-config`);
                const data = await response.json();
                showTestResult(`‚úÖ –ö–æ–Ω—Ñ–∏–≥ –∑–∞–≥—Ä—É–∂–µ–Ω: ${data.slides?.length || 0} —Å–ª–∞–π–¥–æ–≤`);
            } catch (error) {
                showTestResult(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞: ${error.message}`);
            }
        }

        async function testAIChat() {
            showTestResult('ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ò–ò —á–∞—Ç–∞...');
            try {
                const response = await fetch(`${BACKEND_URL}/api/chat-diana`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                        context: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'
                    })
                });
                const data = await response.json();
                showTestResult(`‚úÖ –ò–ò –æ—Ç–≤–µ—Ç–∏–ª: "${data.response?.substring(0, 100)}..."`);
            } catch (error) {
                showTestResult(`‚ùå –û—à–∏–±–∫–∞ –ò–ò: ${error.message}`);
            }
        }

        async function testFullStack() {
            showTestResult('üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞...');
            await testBackendHealth();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testQuizConfig();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testAIChat();
            showTestResult('üéâ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!');
        }

        function showTestResult(message) {
            const resultsDiv = document.getElementById('test-results');
            if (!resultsDiv.querySelector('.response-box')) {
                resultsDiv.innerHTML = '<div class="response-box" id="results-box"></div>';
            }
            const box = document.getElementById('results-box');
            box.innerHTML += message + '\n';
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
